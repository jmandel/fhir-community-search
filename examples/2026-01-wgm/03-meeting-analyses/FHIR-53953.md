# FHIR-53953: No documentation on remote interactions - timeouts, error handling, caching, performance etc.

## Issue Overview

Brian Postlethwaite requests a new documentation section addressing the operational aspects of FHIRPath functions that involve remote system calls. These functions can interact with external terminology servers, conformance servers, or FHIR servers, introducing concerns around performance, timeouts, availability, security, and error handling that are not currently documented.

The request proposes adding a "Handling Remote Data" section at the end of the FHIRPath page that addresses these cross-cutting concerns. The reporter also raises the question of how unavailable content should be handled - suggesting empty results rather than exceptions, and proposes a potential `traceOnRemoteError()` function.

This issue addresses a significant gap in the specification where implementers must make independent decisions about operational behavior, potentially leading to inconsistent user experiences across implementations.

## Current State

The FHIRPath specification currently documents the functional behavior of remote-interaction functions but does not address:
- Timeout handling and recommended defaults
- Error handling strategies (empty vs exception)
- Caching expectations and guidance
- Security considerations for remote calls
- Performance implications and optimization strategies
- Availability and fallback behaviors

**Functions with remote interaction potential:**
- `resolve()` - when resource is not contained
- Terminology functions: `memberOf`, `subsumes`, `subsumedBy`, `weight`, `%terminology` factory
- Profile functions: `conformsTo`, `slice`, `elementDefinition` (may need conformance server)
- `%server` factory functions (all operations)

## Stakeholder Perspectives

**Reporter (Brian Postlethwaite)**: As a FHIRPath engine implementer, Brian needs clarity on expected behavior when remote services are unavailable or slow. His suggestion for "return empty rather than throw exception" reflects practical implementation experience.

No other comments on the issue yet.

## Related Issues & Discussions

- **FHIR-53954**: Questions whether %factory and %server are mature enough for normative
- **FHIR-53960**: Inconsistent error handling patterns across functions
- **FHIR-54074**: Detailed critique of %server functions including error handling
- **FHIR-54078**: Type Factory maturity concerns

**Zulip Discussion**: In #fhirpath, Paul Lynch raised whether `memberOf` (and `subsumes`/`subsumedBy`) should take an optional parameter to specify the terminology server - directly relevant to this issue's scope.

## Technical Considerations

1. **Context dependency**: Remote behavior varies by context (validation vs runtime query vs batch processing). Different contexts may need different timeout/error strategies.

2. **Security implications**: Remote calls from FHIRPath expressions could be attack vectors (SSRF, data exfiltration). Security boundaries need documentation.

3. **Caching complexity**: Cache invalidation for terminology and conformance data is non-trivial. What are acceptable staleness bounds?

4. **Synchronous vs asynchronous**: FHIRPath is inherently synchronous, but remote calls benefit from async patterns. How should implementations handle this?

5. **Error propagation**: The suggestion to return empty on error conflicts with some use cases where knowing about errors is critical (e.g., validation).

6. **Tracing/debugging**: The proposed `traceOnRemoteError()` function would help debugging but adds complexity.

## Potential Courses of Action

### Option A: Add Comprehensive Remote Interaction Section
- **Description**: Create new section documenting all aspects of remote interactions as requested
- **Pros**: 
  - Complete guidance for implementers
  - Consistent behavior across implementations
  - Addresses security considerations explicitly
- **Cons**: 
  - May prescribe behaviors that don't fit all use cases
  - Significant new normative content
  - May conflict with existing implementation decisions
- **Impact**: Compatible, substantive (new normative guidance)

### Option B: Guidance Section with Implementation Flexibility
- **Description**: Add section with general guidance and recommendations, leaving specific behaviors as implementation choices
- **Pros**: 
  - Acknowledges context-dependent needs
  - Less prescriptive, more adoptable
  - Faster to produce
- **Cons**: 
  - Doesn't fully solve interoperability
  - May still leave implementer confusion
- **Impact**: Non-substantive (guidance only)

### Option C: Defer to Incubator with %server/%factory
- **Description**: If %server and %factory move to incubator (per FHIR-53954), include remote interaction guidance there
- **Pros**: 
  - Keeps normative FHIRPath simpler
  - Allows experimentation with remote patterns
  - Aligned with maturity concerns
- **Cons**: 
  - Still need guidance for `resolve()`, terminology functions
  - Splits documentation
- **Impact**: Depends on FHIR-53954 resolution

### Option D: Document Context-Specific Behaviors
- **Description**: Define different expected behaviors for different contexts (validation, querying, etc.)
- **Pros**: 
  - Acknowledges real-world complexity
  - Allows appropriate behavior per use case
- **Cons**: 
  - Complex specification
  - More implementation burden
- **Impact**: Compatible, substantive

## Questions for the Workgroup

1. Should remote call failures return empty collections or throw errors? Should this vary by context?

2. What security boundaries should be documented for remote-capable functions?

3. Should the specification prescribe timeout defaults or leave this to implementations?

4. Is `traceOnRemoteError()` or similar debugging capability worth adding?

5. How does this relate to the potential incubator move of %server/%factory?

6. Should caching guidance be normative or informational?

## References

- [FHIR-53953 Jira Issue](https://jira.hl7.org/browse/FHIR-53953)
- [FHIRPath Specification Page](https://hl7.org/fhir/6.0.0-ballot4/fhirpath.html)
- [Zulip: memberOf terminology server parameter](https://chat.fhir.org/#narrow/stream/fhirpath/topic/memberOf%20-%20%20specify%20terminiology%20server%3F)
- Related: [FHIR-53954](https://jira.hl7.org/browse/FHIR-53954), [FHIR-53960](https://jira.hl7.org/browse/FHIR-53960)
