# FHIR-53999: href should not be used in narratives to reference FHIR resources

## Issue Overview

James Jahns identifies inconsistency in how the FHIR specification describes referencing FHIR resources from narrative content. Some spec sections (Bundle, HTTP) imply that `<a href="">` attributes in narratives could point to FHIR resources, while the narrative guidance page recommends using extensions instead, with no mention of href for this purpose.

The reporter argues that using href to reference FHIR resources is problematic because:
- Such links often won't work for end users (leading to raw data or errors)
- Different display implementations might handle this inconsistently
- This could be clinically unsafe

The recommendation is to remove mentions of href for FHIR resource references and explicitly discourage this pattern, or alternatively, provide clear guidance on how href should be handled during narrative display.

## Current State

**Spec sections mentioning href for resources:**

1. **Bundle page** (https://build.fhir.org/bundle.html):
   > "These connections might be via Reference, canonical, url, or 'href' references within narrative."

2. **HTTP page** (https://build.fhir.org/http.html):
   > "Servers SHALL replace all matching links in the bundle... and `<a href="">` & `<img src="">` in the Narrative elements..."

**Narrative guidance page** (https://build.fhir.org/narrative.html#linking):
- Describes using extensions (`narrativeLink`, `originalText`) to link between narrative and resources
- No mention of using href for resource references

**The inconsistency:**
Bundle and HTTP pages suggest href can point to FHIR resources; Narrative page doesn't mention this and recommends extensions instead.

## Stakeholder Perspectives

**Reporter (James Jahns)**: Prefers removing href mentions to minimize complexity in narrative display. Notes that href creates many edge cases (bundle vs REST resolution, reference resolution failures, distinguishing FHIR resource links from other links).

No other comments yet.

## Related Issues & Discussions

**Extensive Zulip discussion** in #IPS > "Referencing from IPS narrative to data" (226 messages, Nov 2023 - Sep 2025):

Key points from the discussion:

1. **Original proposal (Grahame Grieve)**: Use id/idref attributes to map narrative elements to resources:
   ```html
   <tr idref="t1">...</tr>
   ```
   with `section.entry.id = "t1"`

2. **Problem discovered**: `idref` is not valid in XHTML/XML!

3. **Current solution**: New `textLink` extension on Narrative.text that maps HTML ids to resource references:
   ```json
   {
     "url": "http://hl7.org/fhir/StructureDefinition/textLink",
     "extension": [
       {"url": "htmlid", "valueString": "row-123"},
       {"url": "data", "valueUri": "Condition/456"}
     ]
   }
   ```

4. **IPS example**: Now uses textLink extension for narrative-to-data linking

5. **Validator support**: FHIR validator supports textLink extension validation

**Related Jira issues:**
- FHIR-43316: Narrative linking pattern for IPS
- FHIR-48338: Validator behavior for idref

## Technical Considerations

1. **href resolution complexity**:
   - Relative vs absolute URLs
   - Bundle-internal vs external references
   - Content negotiation (JSON vs XML vs HTML)
   - Authentication requirements

2. **User experience**: Clicking an href that returns JSON/XML is poor UX

3. **Security**: Following href links could leak patient data to external servers

4. **textLink extension adoption**: The new textLink extension provides a cleaner alternative

5. **Binary resources**: href to Binary resources for images/documents may still be appropriate (as noted for `<img src>`)

6. **FHIR Clinical Documents**: The FHIR Clinical Document IG also needs this guidance

7. **CDA compatibility**: CDA uses narrative linking extensively - FHIR should support similar patterns

## Potential Courses of Action

### Option A: Remove href Mentions, Recommend textLink Extension
- **Description**: Remove mentions of href for FHIR resources from Bundle/HTTP pages; point to textLink extension instead
- **Pros**: 
  - Consistent with narrative page guidance
  - Uses purpose-built solution (textLink)
  - Reduces implementation complexity
  - Addresses IPS/Clinical Document needs
- **Cons**: 
  - Breaking change for implementations using href
  - Extension adds verbosity
  - May not align with how some systems generate narratives
- **Impact**: Non-compatible (behavioral guidance change)

### Option B: Document href Display Requirements
- **Description**: Keep href mention but add explicit guidance on display handling (like img src guidance)
- **Pros**: 
  - Doesn't break existing implementations
  - Addresses the ambiguity
- **Cons**: 
  - Adds complexity to display implementations
  - Still has the edge cases reporter mentioned
  - May not be implementable consistently
- **Impact**: Non-substantive (documentation)

### Option C: Clarify Scope of href Usage
- **Description**: Document that href can reference resources for server processing (rewriting) but should not be expected to work for end-user display
- **Pros**: 
  - Maintains server rewriting capability
  - Sets appropriate expectations
- **Cons**: 
  - Complex nuance to communicate
  - May still cause implementer confusion
- **Impact**: Non-substantive (documentation)

### Option D: Dual Approach - href for Servers, textLink for Display
- **Description**: href is for server reference rewriting; textLink is for display-time narrative linking
- **Pros**: 
  - Serves both use cases
  - Clear separation of concerns
- **Cons**: 
  - Complexity
  - Two mechanisms for related purposes
- **Impact**: Non-substantive (documentation)

## Questions for the Workgroup

1. What is the primary use case for href mentions in Bundle/HTTP pages - server rewriting only, or also display?

2. Should textLink extension be the recommended approach for narrative-to-resource linking?

3. Are there implementations that depend on href pointing to FHIR resources in narratives?

4. Should href to Binary resources be handled differently than href to other resources?

5. How should this guidance align with IPS and FHIR Clinical Documents specifications?

6. Should the narrative page be updated to explicitly discourage href for resource references?

## References

- [FHIR-53999 Jira Issue](https://jira.hl7.org/browse/FHIR-53999)
- [Bundle page](https://build.fhir.org/bundle.html)
- [HTTP page](https://build.fhir.org/http.html)
- [Narrative page - Linking](https://build.fhir.org/narrative.html#linking)
- [textLink extension](https://build.fhir.org/ig/HL7/fhir-extensions/StructureDefinition-textLink.html)
- [Zulip: IPS narrative linking](https://chat.fhir.org/#narrow/stream/IPS/topic/Referencing%20from%20IPS%20narrative%20to%20data)
- [FHIR-43316: IPS narrative linking](https://jira.hl7.org/browse/FHIR-43316)
