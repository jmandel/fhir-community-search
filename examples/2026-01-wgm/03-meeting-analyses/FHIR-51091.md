# FHIR-51091: ElementDefinition contexts table is incomplete

## Issue Overview

Lloyd McKenzie identifies a gap in the ElementDefinition interpretation table that affects how constraints like `minValue[x]`, `maxValue[x]`, and `maxLength` can be used in different structure definition contexts.

The table currently covers two situations - "Type definition" and "Constraint definition" - which correspond to `kind = 'specialization'` and `kind = 'constraint'` in StructureDefinition. However, this doesn't properly account for **logical models**, which use `kind = 'logical'`.

The current enforcement (based on the table) prohibits minValue, maxValue, and maxLength in logical models. However, Lloyd argues this restriction doesn't make sense for logical models, which are context-specific structures where such constraints would be perfectly appropriate - unlike generic resources and complex types where they would be overly restrictive.

## Current State

The ElementDefinition interpretation table at https://build.fhir.org/elementdefinition.html#interpretation defines which ElementDefinition properties are valid in different contexts:

- **Type definition** (kind = 'specialization'): Generic structure definitions for resources, complex types, and primitive types
- **Constraint definition** (kind = 'constraint'): Profiles that constrain existing types

The page is **normative**, meaning changes require careful consideration.

Currently enforced rules that may be incorrect:
- minValue[x], maxValue[x], maxLength are prohibited in "type definitions"
- This prohibition is applied to ALL specializations, including logical models
- But logical models (kind = 'logical') should arguably be able to define these constraints since they're context-specific

Notable: Simple types (id, string, integer types) already have these constraints defined via invariants, suggesting the prohibition isn't absolute.

## Stakeholder Perspectives

**Reporter (Lloyd McKenzie):** HL7 CTO and FHIR co-chair, identifies this as a logical gap that affects tooling and validation. The question is whether this correction can be made given the page's normative status.

**Gino Canessa (Comment):** Requests that Lloyd draft:
1. Additions to the table for root element and following elements of Logical Models
2. Review of the "Path" table in the same section for related changes

## Related Issues & Discussions

### Zulip Discussions
- 2016 discussion by Grahame Grieve questioning whether minValue/maxValue make sense for logical models
- Discussions about logical model constraints in #conformance
- Questions about content references and logical models in #shorthand

## Technical Considerations

1. **Normative Page**: The elementdefinition.html page is normative - changes need to follow HL7's normative change process

2. **Validation Impact**: Current validators may reject minValue/maxValue/maxLength in logical models based on this table

3. **Backward Compatibility**: Adding permissions (allowing something previously prohibited) is generally safe

4. **Logical Model Use Cases**:
   - Defining data exchange formats for external systems
   - Modeling legacy data structures
   - CDS/CQL inputs often use logical models with value constraints

5. **Related Constraints**: The "Path" table in the same section may also need updates for logical model consistency

## Potential Courses of Action

### Option A: Add Logical Model Column to Interpretation Table
- **Description**: Explicitly add a "Logical Model definition" column to the interpretation table with appropriate rules for each ElementDefinition property
- **Pros**: 
  - Clear, explicit specification
  - Addresses the gap completely
  - Allows validators to implement correct behavior
- **Cons**: 
  - Requires drafting complete column (work for Lloyd)
  - Normative change process
  - May reveal other properties that need logical model rules
- **Impact**: Medium effort, correct long-term solution

### Option B: Clarify Logical Models as Separate Category
- **Description**: Add clarifying text that logical models (kind='logical') are NOT considered "type definitions" for purposes of this table, and have different rules
- **Pros**: 
  - Simpler change
  - Clarifies intent without full table rework
- **Cons**: 
  - Less precise than full column
  - Still leaves some ambiguity
- **Impact**: Lower effort, addresses immediate issue

### Option C: Move Detailed Rules to STU Extension
- **Description**: Keep the normative table minimal and move detailed context-specific rules to an STU extension that can evolve more easily
- **Pros**: 
  - Reduces normative surface area
  - Allows faster iteration on edge cases
- **Cons**: 
  - Complicates the specification
  - Key behaviors become less stable
- **Impact**: Architectural change, may not be appropriate at this stage

### Option D: Technical Correction
- **Description**: Treat this as a technical correction to the normative content - the intent was never to prohibit these in logical models
- **Pros**: 
  - Fast resolution
  - Aligns spec with original intent
- **Cons**: 
  - Normative changes require careful process
  - Need to verify original intent
- **Impact**: Depends on process for technical corrections to normative content

## Questions for the Workgroup

1. Was the prohibition of minValue/maxValue/maxLength in logical models intentional or an oversight?

2. Should logical models have their own column in the interpretation table, or be grouped with one of the existing categories?

3. What is the process for making corrections to normative pages like elementdefinition.html?

4. Are there other ElementDefinition properties where logical models should have different rules than resources/complex types?

5. Should Lloyd's draft additions be reviewed by the broader conformance community before adoption?

6. Does the Path table also need updates for logical models?

## References

- Jira: https://jira.hl7.org/browse/FHIR-51091
- ElementDefinition interpretation table: https://build.fhir.org/elementdefinition.html#interpretation
- StructureDefinition.kind: https://build.fhir.org/structuredefinition-definitions.html#StructureDefinition.kind
- Logical Models: https://build.fhir.org/structuredefinition.html#logical
