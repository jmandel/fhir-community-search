# FHIR-36651: Define a "term-filter" Modifier on Type "token"

## Issue Overview

This long-standing issue (originally from 2022) proposes adding terminology-aware filtering capabilities to FHIR search. The core problem: there's no direct way to query for clinical data based on terminology properties or designations. For example, you cannot easily search for:

- "All medication prescriptions where the code has a designation matching 'tylenol'"
- "All medication prescriptions where the code is a concept with an 'RXTERM_FORM' property matching 'Tab'"

Currently, IG authors work around this by creating additional FHIR resources to serve as search indexes (e.g., MedicationKnowledge resources in the DaVinci Drug Formulary IG). This doesn't scale well and creates inconsistency across IGs.

The proposed solution has evolved significantly through discussion, moving from a simple `:term-filter` modifier to a more comprehensive approach involving VCL (ValueSet Compose Language) and implicit ValueSets.

## Current State

The discussion has converged on a multi-part solution:

1. **VCL (ValueSet Compose Language)**: A URL-friendly syntax for defining ValueSets, documented at [VCL IG Guidance](https://build.fhir.org/ig/FHIR/ig-guidance/vcl.html)

2. **Implicit ValueSets**: Using VCL expressions to define ValueSets inline via URL patterns, which can then be used with existing `:in` and `:not-in` modifiers

3. **Designation Filtering**: A well-known "designation" property for filtering on concept designations (display names, synonyms, etc.)

The latest proposal from Michael Lawley (December 2025) suggests:
- Adding "designation" as a well-known property in the FHIR concept-properties CodeSystem
- Using "=" operator for case-insensitive wildcard matching (with explicit `*`)
- Supporting modifiers for designation.use and designation.language

## Stakeholder Perspectives

**Josh Mandel** (Original Reporter):
- Identified the use case from DaVinci Drug Formulary IG
- Supports the VCL approach
- Asked (Nov 2025) whether VCL changes would obviate the need for a term-filter modifier

**Michael Lawley** (Primary Solution Architect):
- Developed the VCL proposal
- Presented at FHIR DevDays 2023
- Latest proposal (Dec 2025) defines designation filtering syntax with use/language modifiers
- Notes that designation matching is "not yet addressed by ValueSet.compose / VCL"

**Grahame Grieve**:
- Strongly opposed to VCL supporting anything that can't be expressed in ValueSet.compose
- Agreed with using a subset/variant of ECL as the syntax base
- Critical of ECL syntax: "ECL is a horrible syntax"
- Wants isomorphic transformation to ValueSet.compose

**Lloyd McKenzie**:
- Asked for reconciliation between VCL and ValueSet.compose
- Expression syntax must be aligned

**From Zulip Discussion (terminology > VCL):**

**Jim Steel**: VCL is simpler than ECL; addresses property navigation needs

**Peter Jordan**: Notes that medication-related use cases are complicated because information models were rendered into terminologies

## Related Issues & Discussions

- [VCL Documentation](https://build.fhir.org/ig/FHIR/ig-guidance/vcl.html)
- [Zulip: terminology > VCL](https://chat.fhir.org/#narrow/stream/terminology/topic/VCL) - Extensive technical discussion
- [DevDays 2023 Presentation](https://whova.com/embedded/session/mkGzezDgjAsoF3XZ6QNcwWSoj4VO6ShJhLbBT4-uPVE%3D/2975181/) - Michael Lawley's VCL talk
- [DaVinci Drug Formulary IG](http://build.fhir.org/ig/HL7/davinci-pdex-formulary/) - Original motivating use case
- Related to Terminology Infrastructure workgroup

## Technical Considerations

1. **Implementation Complexity**: Terminology-based filtering requires servers to have deep terminology capabilities, which many don't have.

2. **Performance**: Filtering on designations across large code systems (like RxNorm, SNOMED) could be expensive.

3. **Property Navigation**: The ability to traverse property relationships (e.g., "give me substances contained in these drugs") goes beyond simple filtering and isn't supported in ValueSet.compose.

4. **Implicit ValueSet URI Syntax**: Proposed format: `[CodeSystem-URI]?vs=vcl/[expression]`

5. **Designation Syntax**: Proposed modifiers for use and language:
   - `designation:|preferredForLanguage = "*tylenol*"`
   - `designation:@en,en-* = "*tylenol*"`

6. **Wildcard Semantics**: Using `*` for wildcards requires explicit specification; case-insensitive matching.

## Potential Courses of Action

### Option A: Complete VCL + Implicit ValueSet Approach
- **Description**: Finalize VCL specification including designation filtering; use implicit ValueSets with existing `:in` modifier
- **Pros**: Comprehensive solution; works with existing search infrastructure; powerful capabilities
- **Cons**: Complex; requires terminology server capabilities; still missing designation filtering in VCL
- **Impact**: Compatible, substantive change; requires TI coordination

### Option B: Add Simple :term-filter Modifier
- **Description**: Add a `:term-filter` modifier for basic designation/property matching without full VCL
- **Pros**: Simpler to implement; addresses immediate use cases
- **Cons**: Limited compared to VCL; may be superseded; creates technical debt
- **Impact**: Compatible, substantive change

### Option C: Finalize Designation Property Only
- **Description**: Focus on adding the "designation" well-known property to enable designation filtering via existing mechanisms
- **Pros**: Targeted solution for the most common use case; builds on existing infrastructure
- **Cons**: Doesn't address property navigation; incomplete solution
- **Impact**: Compatible, substantive terminology change

### Option D: Defer to TI Workgroup
- **Description**: Recognize this as primarily a Terminology Infrastructure issue and coordinate FHIR-I's role
- **Pros**: Appropriate workgroup ownership; focused expertise
- **Cons**: May delay resolution; coordination overhead
- **Impact**: Process/coordination change

### Option E: Define Extension Point Now, Full Solution Later
- **Description**: Define an extension mechanism (e.g., `_termFilter` parameter) for implementations to experiment; standardize based on experience
- **Pros**: Allows experimentation; doesn't lock in premature design
- **Cons**: Fragmentation risk; delayed standardization
- **Impact**: Non-substantive; creates experimental extension

## Questions for the Workgroup

1. Is the VCL approach ready for normative inclusion, or does it need more implementation experience?

2. What is the division of responsibility between FHIR-I and Terminology Infrastructure for this issue?

3. Is the designation filtering proposal (December 2025) acceptable?

4. Should property navigation (which can't be expressed in ValueSet.compose) be supported?

5. What is the implementation timeline expectation for terminology servers to support these capabilities?

6. How do we balance the desire for powerful terminology search against implementation burden?

## References

- [FHIR-36651 Jira Issue](https://jira.hl7.org/browse/FHIR-36651)
- [VCL Documentation](https://build.fhir.org/ig/FHIR/ig-guidance/vcl.html)
- [FHIR Search - Token Type](https://build.fhir.org/search.html#token)
- [ValueSet.compose](https://build.fhir.org/valueset-definitions.html#ValueSet.compose)
- [FHIR Concept Properties CodeSystem](http://hl7.org/fhir/concept-properties)
- [Zulip: terminology > VCL](https://chat.fhir.org/#narrow/stream/terminology/topic/VCL)
- [DaVinci Drug Formulary IG](http://build.fhir.org/ig/HL7/davinci-pdex-formulary/use_cases_and_overview.html#searching-by-drug-name)
