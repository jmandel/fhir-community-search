# FHIR-51623: Allow extensions on Bundle root

## Issue Overview

Cooper Thompson (Epic) requests updating Bundle (and possibly Binary and Parameters) to allow root-level extensions. Currently, these three resources inherit directly from Resource rather than DomainResource, which means they cannot have extensions or narrative at the root level.

This limitation has caused practical workarounds, such as placing extensions on `Bundle.identifier` even when the extensions have nothing to do with identifiers. The request is driven by real implementation needs encountered at Epic.

A specific recent use case was discussed on Zulip regarding conveying additional search information in R4 Bundles, where `Bundle.issues` (available in R5+) would have been helpful but isn't available due to the no-extensions limitation.

## Current State

FHIR has three resources that inherit directly from Resource rather than DomainResource:
- **Bundle**: Container for collections of resources
- **Binary**: Raw data content
- **Parameters**: Operation parameters

This design choice was **intentional** according to FHIR-35845:
> "Extension is defined in DomainResource, which is the parent for most resources. Extension is *not* available at the root for the three resources that inherit directly from Resource - Bundle, Binary and Parameters. This is intentional, as we don't *want* extensions to be available on these three resources. Similarly, these three resources also don't have an ability to capture narrative."

However, the current workaround of using `Bundle.meta` for extensions (as mentioned in Zulip discussions) is functional but semantically awkward.

## Stakeholder Perspectives

**Reporter (Cooper Thompson, Epic):** Has encountered multiple situations needing root-level extensions on Bundle. Current workaround of using `Bundle.identifier` is semantically incorrect.

**Lloyd McKenzie (Zulip):** Asked about backport handling for Bundle extensions, indicating awareness of the limitation.

**Gino Canessa (Zulip):** Confirmed that `Bundle.meta` can hold extensions as a workaround. Also noted that `Bundle.issues` is not being backported because extensions cannot contain resources.

**Elliot Silver (Zulip):** Confirmed that extensions can be placed on `Bundle.meta` and its child elements.

**Historical Decision (FHIR-35845):** The prohibition was intentional - the design rationale was that these resources are infrastructure containers that shouldn't need extensions.

## Related Issues & Discussions

### Zulip Discussions
- **"Conveying additional Search Info in R4 Bundles"** (2025-08-01): Discussion about using `Bundle.meta` for extensions when `Bundle.issues` isn't available. Alexander Kiel needed to add SQL EXPLAIN info to search bundles.
- **"extension in Bundle"** (2023-11-22): John Moehrke confirmed extensions can go on `Bundle.meta` and `Bundle.meta.security` but not Bundle root.

### Related Jira
- **FHIR-35845**: Resolved - explained why Bundle doesn't have extensions (intentional design)

## Technical Considerations

1. **DomainResource Inheritance**: Changing Bundle to inherit from DomainResource would be a significant structural change affecting all Bundle processing

2. **Backward Compatibility**: Adding extension support to Bundle could break validators expecting no extensions

3. **Narrative**: If extensions are allowed, should narrative also be allowed on Bundle? (Currently prohibited for same reason)

4. **Processing Overhead**: Extensions at root level could complicate Bundle processing for systems that assume simple structure

5. **Meta Workaround**: Extensions on `Bundle.meta` are already possible and may be sufficient for many use cases

6. **Binary and Parameters**: Should these also be updated if Bundle is changed?

7. **Bundle.issues (R5+)**: R5 added `Bundle.issues` for OperationOutcome, addressing one use case but implemented differently than extensions

## Potential Courses of Action

### Option A: Allow Extensions on Bundle Root
- **Description**: Add optional `extension` and `modifierExtension` elements to Bundle (keeping it as Resource subtype, not DomainResource)
- **Pros**: 
  - Addresses the use case directly
  - Consistent with extension availability elsewhere
  - Enables clean data modeling
- **Cons**: 
  - Reverses intentional design decision
  - Breaking change for validators
  - May complicate Bundle processing
  - Sets precedent for Binary and Parameters
- **Impact**: Moderate change, requires revisiting original design rationale

### Option B: Make Bundle Inherit from DomainResource
- **Description**: Change Bundle's parent class from Resource to DomainResource
- **Pros**: 
  - Consistent with all other resources
  - Also enables narrative support
  - Standard extension handling
- **Cons**: 
  - Significant structural change
  - Adds `text` element that may be inappropriate for many Bundle uses
  - Breaking change for implementations
- **Impact**: Major change, significant compatibility concerns

### Option C: Document Bundle.meta as Extension Location
- **Description**: Formally document that extensions needed at Bundle level should be placed on `Bundle.meta` and define best practices
- **Pros**: 
  - No spec change required
  - Already works today
  - Non-breaking
- **Cons**: 
  - Semantically imprecise (meta is about metadata)
  - Doesn't address all use cases
  - Feels like a workaround
- **Impact**: Documentation only, preserves status quo

### Option D: Define Specific Bundle Extensions
- **Description**: Rather than generic extension support, define specific extensions for known use cases (like `Bundle.issues` was added in R5)
- **Pros**: 
  - Controlled expansion of Bundle capabilities
  - Each addition can be evaluated on merits
  - Preserves intentional simplicity
- **Cons**: 
  - Case-by-case approach is slow
  - Doesn't address general extensibility need
  - May result in inconsistent patterns
- **Impact**: Incremental approach, addresses specific needs

### Option E: Status Quo (Decline)
- **Description**: Maintain the intentional prohibition, document that Bundle.meta should be used for extension-like needs
- **Pros**: 
  - Preserves original design intent
  - No breaking changes
  - Bundle remains simple infrastructure resource
- **Cons**: 
  - Doesn't address the real use cases
  - Forces awkward workarounds
- **Impact**: No change, ongoing workarounds needed

## Questions for the Workgroup

1. Has the original design rationale ("we don't want extensions on these resources") been validated against current use cases?

2. What specific extensions has Cooper needed on Bundle that couldn't be addressed by Bundle.meta?

3. If extensions are allowed, should `modifierExtension` also be allowed? (This has significant processing implications)

4. Should Binary and Parameters be treated the same way as Bundle?

5. Would allowing extensions on Bundle fundamentally change how implementations process Bundles?

6. Is there a pattern in R5's `Bundle.issues` that could be generalized?

## References

- Jira: https://jira.hl7.org/browse/FHIR-51623
- Bundle resource: https://build.fhir.org/bundle.html
- Resource vs DomainResource: https://build.fhir.org/resource.html
- FHIR-35845 (design rationale): https://jira.hl7.org/browse/FHIR-35845
- Zulip thread: https://chat.fhir.org/#narrow/channel/179166-implementers/topic/Conveying.20additional.20Search.20Info.20in.20R4.20Bundles
