# FHIR-54511: Documents Bundle should also be possible based on DiagnosticReport

## Issue Overview

Bas van den Heuvel raises an important structural issue with FHIR documents: while FHIR recognizes both Composition and DiagnosticReport as document resources, the Bundle type="document" is currently constrained to require a Composition as the first entry. This prevents DiagnosticReport-based documents from being stored in a FHIR document Bundle.

This is a practical problem for deployments implementing IHE profiles (such as IHE Integrated Diagnostic Reporting - IDR) where DiagnosticReport serves as the primary document resource without an accompanying Composition.

The reporter proposes either extending the existing document Bundle definition to allow DiagnosticReport as the first entry, or creating a new Bundle type (e.g., "diagnostic-report") specifically for DiagnosticReport-based documents.

## Current State

The Bundle resource definition includes invariant **bdl-1**:
> "A document must have a Composition as the first resource"

The FHIRPath expression: `type = 'document' implies (entry.first().resource.is(Composition))`

This means:
- Document Bundles can ONLY start with Composition
- DiagnosticReport, despite being described as a "document resource," cannot be the basis of a document Bundle
- Systems using DiagnosticReport as standalone clinical documents (lab reports, imaging reports) cannot use Bundle type="document"

The documents page (https://build.fhir.org/documents.html) describes FHIR documents but focuses entirely on Composition-based documents.

## Stakeholder Perspectives

**Reporter (Bas van den Heuvel):** Represents a Philips perspective and European healthcare context where IHE profiles commonly use DiagnosticReport as the primary document structure. The limitation creates interoperability gaps.

No other comments have been posted yet.

### Zulip Discussions
- Discussions in #implementers and #europe channels about representing clinical documents
- IHE IDR (Integrated Diagnostic Reporting) profile is mentioned as a use case
- Questions about DiagnosticReport vs Composition for imaging/lab reports
- Discussion about document structure in genomics context (Bob Dolin suggesting document Bundle profile)

## Related Issues & Discussions

- IHE IDR profile: Uses DiagnosticReport without Composition
- IPS (International Patient Summary): Uses Composition-based approach
- Genomics reports: Discussion about adding Bundle type="document" profile

## Technical Considerations

1. **Bundle Invariants**: Changing bdl-1 would be a breaking change for validators that enforce it

2. **Document Identity**: Composition provides document-level metadata (identifier, date, author, custodian, attester) that DiagnosticReport handles differently

3. **Signature Handling**: The document signature model is built around Composition - how would it work for DiagnosticReport?

4. **Document Sections**: Composition organizes content into sections; DiagnosticReport uses different structure (result references)

5. **Normative Status**: Bundle is normative - changes to document invariants require careful compatibility consideration

6. **Alternative Approaches**: Could DiagnosticReport be wrapped in a Composition? Is that the intended pattern?

## Potential Courses of Action

### Option A: Extend Document Bundle to Allow DiagnosticReport
- **Description**: Modify invariant bdl-1 to allow either Composition OR DiagnosticReport as the first entry: `type = 'document' implies (entry.first().resource.is(Composition) or entry.first().resource.is(DiagnosticReport))`
- **Pros**: 
  - Single document concept in FHIR
  - Enables IHE IDR and similar use cases
  - Minimal structural change
- **Cons**: 
  - Breaking change for validators
  - DiagnosticReport lacks some Composition metadata (sections, attester details)
  - Document-level processing logic would need to handle both types
  - May open door to other resource types wanting document status
- **Impact**: Medium change, significant interoperability benefit

### Option B: Create New Bundle Type "diagnostic-report"
- **Description**: Add a new Bundle.type value for DiagnosticReport-based document collections
- **Pros**: 
  - Clean separation of document types
  - Doesn't change existing document semantics
  - Each type can have appropriate invariants
- **Cons**: 
  - Proliferation of Bundle types
  - Unclear if other resources might need their own types
  - May fragment document handling in implementations
- **Impact**: Medium change, adds complexity but preserves backward compatibility

### Option C: Require Composition Wrapper
- **Description**: Document that DiagnosticReport-based documents SHOULD use a minimal Composition that references the DiagnosticReport, maintaining the Composition-first pattern
- **Pros**: 
  - Maintains single document model
  - Consistent document-level metadata
  - No spec changes needed
- **Cons**: 
  - Adds overhead for simple reports
  - May seem redundant for self-contained DiagnosticReports
  - IHE profiles would need to change
- **Impact**: No spec change, guidance only

### Option D: Use Bundle type="collection" for DiagnosticReport
- **Description**: Clarify that DiagnosticReport-based documents should use Bundle type="collection" rather than "document"
- **Pros**: 
  - No spec changes needed
  - collection type is flexible
- **Cons**: 
  - Loses document semantics (clinical integrity, attestation)
  - Inconsistent with "document resource" description of DiagnosticReport
  - Doesn't solve the document identity problem
- **Impact**: No spec change, but doesn't fully address use case

## Questions for the Workgroup

1. What was the original design intent for DiagnosticReport as a "document resource" if it can't be the basis of a document Bundle?

2. Should the document concept in FHIR be expanded, or should DiagnosticReport documents use a different pattern?

3. Are there other resources that might want to be document roots (CarePlan, ServiceRequest)?

4. How should document-level metadata (attester, event, section) be handled for DiagnosticReport documents?

5. What is the impact on the signatures page and document signing rules if DiagnosticReport becomes a document root?

6. Should we coordinate with IHE before making changes to ensure alignment?

## References

- Jira: https://jira.hl7.org/browse/FHIR-54511
- Bundle resource: https://build.fhir.org/bundle.html
- Documents page: https://build.fhir.org/documents.html
- DiagnosticReport: https://build.fhir.org/diagnosticreport.html
- IHE IDR profile: IHE Integrated Diagnostic Reporting
- Zulip #implementers: https://chat.fhir.org/#narrow/stream/implementers
