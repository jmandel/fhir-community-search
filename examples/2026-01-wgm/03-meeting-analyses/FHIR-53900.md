# FHIR-53900: Contained Resources, Note to Implementers

## Issue Overview

Reinhard Egelkraut points out that the Contained Resources section of the FHIR specification (Chapter 2.1.3.0.14) contains an unresolved "Note to Implementers" question that should be addressed before R6 goes normative:

> "Note to Implementers: There is no way to search for contained resources that reference their container. Is this a problem?"

This open question in the specification indicates an area of uncertainty that hasn't been formally resolved. Including such questions in a normative specification is problematic as it signals the content isn't fully settled.

## Current State

The note appears at https://build.fhir.org/references.html#contained in the section describing contained resources.

**The Question**: Can you search for a contained resource based on a reference from that contained resource back to its container?

**Example Scenario**:
- Organization contains a HealthcareService
- HealthcareService.providedBy references the containing Organization
- Can you find Organizations based on the contained HealthcareService's properties?

**Current Search Capabilities**:
- Searching *into* contained resources is described as a SHOULD: "chained parameters SHOULD be evaluated inside contained resources"
- The `_contained` parameter can request this behavior
- However, searching in the *reverse* direction (finding containers based on contained resource properties) is different

## Stakeholder Perspectives

**Reporter (Reinhard Egelkraut):** Notes this open question should be resolved before normativity.

No other comments on the ticket.

### Zulip Discussions
- **"Parameter to access contained that references container"** (2025-08): Julianne Cohen asked this exact question about searching Organizations based on contained HealthcareService.code
- Paul Church noted: chaining into contained resources "is not widely implemented" - only Grahame's reference implementation fully supports it
- Michele Mottini suggested it's not possible
- Gino Canessa cited the spec's SHOULD language

### Key Quote from Zulip
> "That search looks correct to me but as Gino suggests, chaining or _has into contained resources is not widely implemented. The last time we tried to survey server implementers, the only one we found that fully supported it was Grahame's reference implementation." - Paul Church

## Related Issues & Discussions

### Related Functionality
- `_contained` search parameter
- `_has` reverse chaining
- Chained search parameters
- Contained resource behavior

### Implementation Survey
- Few servers implement search into/through contained resources
- Complexity of indexing contained resources for search is significant

## Technical Considerations

1. **Indexing Complexity**: To search contained resources, servers must index them - this adds storage and update complexity

2. **Reverse Reference Search**: Using `_has` to find a container based on contained resource properties requires sophisticated query planning

3. **Use Case Validity**: Are there real-world needs to find containers based on their contained resources' outbound references?

4. **Implementation Reality**: Few servers support this even for forward chaining, suggesting reverse chaining is even less likely

5. **Specification Consistency**: The note asks a question but doesn't answer it - this is unusual for normative content

6. **Circular Reference**: If contained resource references container, and we search for containers via contained resources, we have circular logic

## Potential Courses of Action

### Option A: Answer "No, Not a Problem" and Remove Note
- **Description**: Determine that this limitation is acceptable, remove the note, and document that this search pattern is explicitly not supported
- **Pros**: 
  - Clean normative text
  - Sets clear expectations
  - Matches implementation reality
- **Cons**: 
  - Closes off potential future capability
  - May surprise users who expect it to work
- **Impact**: Documentation clarification only

### Option B: Answer "Yes, Problem" and Define Behavior
- **Description**: Specify how servers SHOULD support searching for containers based on contained resources' outbound references
- **Pros**: 
  - Complete specification
  - Addresses user need (if real)
- **Cons**: 
  - Implementations don't support this
  - Complex to implement
  - May be theoretical rather than practical need
- **Impact**: New spec content, unlikely to be implemented

### Option C: Convert to Informative Note
- **Description**: Replace the implementer question with an informative note stating this pattern is not currently supported and implementations vary
- **Pros**: 
  - Removes open question
  - Honest about current state
  - Doesn't commit to specific behavior
- **Cons**: 
  - Still leaves behavior undefined
  - May seem like avoiding the issue
- **Impact**: Minor text change

### Option D: Deprecate Contained Resource Search Discussion
- **Description**: Given low implementation support, remove or minimize search-into-contained discussion, focusing contained resources on their primary use case (bundling)
- **Pros**: 
  - Aligns spec with reality
  - Simplifies spec
- **Cons**: 
  - Removes potentially useful functionality
  - Some implementations do support this
- **Impact**: Spec simplification

### Option E: Defer to Post-R6
- **Description**: Remove the note for R6 normative release, add a tracker to address contained resource search comprehensively in R7
- **Pros**: 
  - Clean R6 spec
  - Time to properly investigate
- **Cons**: 
  - Kicks problem down road
  - Users still won't know what to expect
- **Impact**: Defers decision

## Questions for the Workgroup

1. **Is this actually a problem in practice?** Are there real use cases where users need to find containers based on contained resources' outbound references?

2. **What was the original context for this note?** When and why was it added?

3. **Given low implementation support for any contained resource search, should we make stronger statements about what's NOT supported?**

4. **Should contained resource search behavior remain a SHOULD or become a MAY given implementation reality?**

5. **Is it acceptable to have "Note to Implementers" questions in normative content?**

## References

- Jira: https://jira.hl7.org/browse/FHIR-53900
- Contained Resources: https://build.fhir.org/references.html#contained
- Search - Contained Resources: https://build.fhir.org/search.html#contained
- Zulip thread: https://chat.fhir.org/#narrow/stream/179166-implementers/topic/.E2.9C.94.20Parameter.20to.20access.20contained.20that.20references.20container
