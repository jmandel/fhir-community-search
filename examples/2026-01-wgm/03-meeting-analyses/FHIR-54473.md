# FHIR-54473: FHIR Mapping Language not ready for normative

## Issue Overview

This ballot comment from Brian Postlethwaite argues that the FHIR Mapping Language (FML) has significant issues and should not be included in the normative FHIR specification. The proposal is to:

1. Move FML to its own incubator project or separate specification (like FHIRPath/CQL)
2. Keep the StructureMap resource in the normative package
3. Allow the external specification to document how different FHIR versions map to the FML grammar/engine

The commenter indicates they will log separate issues for specific technical problems.

## Current State

The FHIR Mapping Language is currently documented in the core FHIR specification and is being balloted for normative status along with R6. It provides:

- A text-based syntax for defining structural transformations
- Compilation to/from the StructureMap resource
- Integration with FHIRPath for expressions within rules
- Support for cross-version mappings

Related specifications:
- **FHIRPath**: Already a separate specification (hl7.org/fhirpath)
- **CQL (Clinical Quality Language)**: Separate specification
- **StructureMap**: FHIR resource that represents compiled mapping logic

## Stakeholder Perspectives

**Reporter (Brian Postlethwaite):** Believes FML has "many issues" and needs more development time outside the normative process. Sees precedent in FHIRPath and CQL being separate specifications.

No other comments on this specific issue yet, but related issues (FHIR-54474, FHIR-54476, FHIR-54478, FHIR-54479) detail specific technical concerns.

## Related Issues & Discussions

**Related Ballot Issues:**
- **FHIR-54474**: "Source should be able to be a fhirpath expression" - FML enhancement request
- **FHIR-54476**: "StructureMap doesn't happily represent chaining of properties" - Representation concern
- **FHIR-54478**: "How can groups produce collections?" - Semantic clarification needed
- **FHIR-54479**: "Dependent Group parameter variable restrictions" - Spec clarity needed
- **FHIR-46548** (Applied): "Clarify the context of fhirpath expressions" - Previous clarification

**Zulip Discussions (#FHIR Mapping Language stream):**
- "fhirpath expressions as source" - Brian Postlethwaite discussing need to use FHIRPath as source
- "where clause" - 37 messages discussing FHIRPath context within FML rules
- "Conditional group execution" - Implementation questions
- Various implementation issues and questions

## Technical Considerations

1. **Maturity**: FML has been available since DSTU2 but has seen limited implementation compared to other FHIR features. Questions about production readiness.

2. **Implementations**: 
   - Java reference implementation (HAPI)
   - Matchbox
   - .NET port (in progress by Brian Postlethwaite)
   - Limited compared to FHIRPath implementations

3. **Specification Separation Precedent**: FHIRPath was moved to a separate specification. This allows:
   - Independent release cycles
   - Clearer versioning
   - Focus on the language itself
   - Implementation guides for different FHIR versions

4. **StructureMap Resource**: The StructureMap resource (computable form of mappings) could remain in core FHIR even if the text syntax moves out.

5. **Cross-Version Mappings**: FML is used for FHIR cross-version mappings. These mappings need to work across FHIR versions, making a separate spec logical.

6. **Open Issues**: Multiple ballot comments indicate specification gaps (FHIR-54474, 54476, 54478, 54479).

7. **Grammar/Syntax**: The FML grammar has evolved and may need more iteration.

## Potential Courses of Action

### Option A: Move FML to Separate Specification (Like FHIRPath)
- **Description**: Create a standalone FHIR Mapping Language specification under HL7. Keep StructureMap resource in core. Reference the external spec for syntax.
- **Pros**:
  - Independent evolution and release cycles
  - Can address issues without core FHIR ballot cycles
  - Precedent with FHIRPath/CQL
  - Cleaner separation of concerns
  - Can version map language independently from FHIR versions
- **Cons**:
  - Administrative overhead of new spec
  - Fragmentation of documentation
  - Migration effort
- **Impact**: Major restructuring

### Option B: Move FML to Incubator IG
- **Description**: Move FML content to an incubator Implementation Guide while keeping StructureMap in core. Graduate when mature.
- **Pros**:
  - Lower barrier than full specification
  - Allows iteration
  - Can still reference from core
- **Cons**:
  - Incubator may imply less stability than warranted
  - May affect adoption
- **Impact**: Moderate restructuring

### Option C: Keep FML in Core but Mark Trial Use
- **Description**: Keep FML documentation in core FHIR but mark it as Trial Use (not normative) to allow continued evolution.
- **Pros**:
  - Maintains documentation proximity to StructureMap
  - Clear it's still evolving
  - No migration needed
- **Cons**:
  - Mixed normative/trial-use content in core
  - Doesn't address fundamental structure concerns
- **Impact**: Documentation change only

### Option D: Address Specific Issues, Proceed with Normative
- **Description**: Resolve the technical issues raised in FHIR-54474, 54476, 54478, 54479 and proceed with making FML normative in R6.
- **Pros**:
  - Stability for implementations
  - Complete specification in one place
- **Cons**:
  - May lock in design before fully mature
  - Harder to make changes post-normative
  - Tight timeline for ballot cycle
- **Impact**: Dependent on resolution of related issues

### Option E: Defer Normative Status to R7
- **Description**: Keep FML in R6 as STU/Trial Use. Plan for normative in R7 with time to address all concerns.
- **Pros**:
  - More time for implementation experience
  - Can address issues without rush
  - Stability signal without premature normative lock-in
- **Cons**:
  - Delays stability promise
  - May affect adoption
- **Impact**: Maturity level change only

## Questions for the Workgroup

1. **Implementation Status**: What is the current state of FML implementations? Is there sufficient experience for normative?

2. **Issue Severity**: Are the issues in FHIR-54474, 54476, 54478, 54479 fixable within the ballot cycle, or do they indicate deeper design problems?

3. **Specification Model**: Should FML follow the FHIRPath model (separate spec) or remain integrated with core FHIR?

4. **StructureMap Relationship**: If FML moves out, what's the right way to reference it from the StructureMap resource documentation?

5. **Cross-Version Use**: The FHIR cross-version mappings use FML. How does normative status (or lack thereof) affect these?

6. **Resource Commitment**: Is there community commitment to maintain a separate FML specification?

7. **Timeline**: What's the realistic timeline for FML to be "normative ready"?

## References

- [FHIR Mapping Language](https://build.fhir.org/mapping-language.html)
- [StructureMap Resource](https://build.fhir.org/structuremap.html)
- [FHIRPath Specification](https://hl7.org/fhirpath/)
- [Jira Issue FHIR-54473](https://jira.hl7.org/browse/FHIR-54473)
- [Zulip: FHIR Mapping Language stream](https://chat.fhir.org/#narrow/stream/379173-FHIR-Mapping-Language)
- Section 7.8 of FHIR Core Specification
