# FHIR-53984: Allow more types for DataRequirement.valueFilter.value[x]

## Issue Overview

Daniel Schuster (Epic) identifies a type restriction issue with `DataRequirement.valueFilter.value[x]`. Currently, this element only allows `dateTime`, `Period`, and `Duration` types - the same types as `dateFilter.value[x]`. However, the description states that value filters are for elements "other than code-valued or date-valued," suggesting the allowed types are inconsistent with the stated purpose.

The reporter also notes in a follow-up comment that `valueFilter` lacks constraints comparable to `codeFilter` (drq-1) and `dateFilter` (drq-2).

This appears to be either a specification error (wrong types listed) or a documentation error (wrong description), requiring clarification and correction.

## Current State

**Current valueFilter.value[x] types:**
- dateTime
- Period  
- Duration

**Element description states:**
> "Value filters specify additional constraints on the data for elements *other than code-valued or date-valued*"

**Comparison with other filters:**
- `codeFilter`: filters on code-valued elements, has constraint drq-1
- `dateFilter`: filters on date-valued elements, has constraint drq-2
- `valueFilter`: intended for non-code, non-date elements, but only has date-related types, no constraint

**The inconsistency:**
If valueFilter is for "other than code-valued or date-valued" elements, why does it only allow date-related types (dateTime, Period, Duration)?

## Stakeholder Perspectives

**Reporter (Daniel Schuster, Epic)**: Identified the type/description mismatch. Follow-up comment notes missing constraints.

No other comments yet.

## Related Issues & Discussions

**Zulip**: Historical tracker notifications found:
- FHIR-32372, FHIR-32373, FHIR-32684: Original issues that led to adding valueFilter to DataRequirement

The valueFilter element was added relatively recently (R5 timeframe) to address needs for filtering on non-code, non-date elements. The current type restriction may be an oversight from initial implementation.

## Technical Considerations

1. **Use cases for valueFilter**: What element types actually need filtering?
   - Quantity (lab values, vitals)
   - Integer/Decimal (scores, counts)
   - String (identifiers, names)
   - Boolean (status flags)
   - Reference (specific resources)

2. **Type explosion risk**: Adding too many types to value[x] increases complexity

3. **FHIRPath alternative**: Complex filtering could be done via FHIRPath expressions instead of expanding value[x]

4. **Constraint needs**: What validation rules should apply to valueFilter?

5. **Backward compatibility**: Adding types is generally compatible; removing/changing isn't

6. **Clinical reasoning usage**: DataRequirement is heavily used in CDS and quality measure definitions - changes affect those ecosystems

## Potential Courses of Action

### Option A: Expand value[x] Types to Match Intent
- **Description**: Add types appropriate for non-code, non-date filtering (Quantity, integer, decimal, string, boolean, Reference, etc.)
- **Pros**: 
  - Aligns types with documented purpose
  - Enables intended use cases
  - Comprehensive solution
- **Cons**: 
  - Significant type expansion
  - May need FHIRPath for complex comparisons anyway
  - Increases implementation complexity
- **Impact**: Compatible, substantive (adding types)

### Option B: Correct Description to Match Types
- **Description**: Change description to clarify valueFilter is for date-range filtering on non-dateFilter elements
- **Pros**: 
  - Minimal change
  - Types already implemented
- **Cons**: 
  - Doesn't address actual filtering needs
  - May not reflect original intent
  - Leaves gap for non-date filtering
- **Impact**: Non-substantive (documentation)

### Option C: Add Targeted Types + Constraint
- **Description**: Add Quantity and a few other high-value types; add appropriate constraint (drq-3)
- **Pros**: 
  - Addresses most common needs
  - Maintains manageable complexity
  - Adds missing constraint
- **Cons**: 
  - May not cover all use cases
  - Still leaves some filtering gaps
- **Impact**: Compatible, substantive

### Option D: Deprecate valueFilter, Use FHIRPath
- **Description**: Recommend using FHIRPath expressions for complex filtering instead of expanding valueFilter
- **Pros**: 
  - FHIRPath is more expressive
  - Avoids type explosion
  - Already available mechanism
- **Cons**: 
  - Doesn't fix the existing inconsistency
  - FHIRPath has learning curve
  - Deprecation has its own issues
- **Impact**: Non-substantive (guidance change)

## Questions for the Workgroup

1. What was the original intent of valueFilter - what use cases was it designed to address?

2. Which additional types are most needed for real-world DataRequirement usage?

3. Should valueFilter mirror the flexibility of FHIRPath expressions, or be limited to common patterns?

4. What constraint should apply to valueFilter (comparable to drq-1 and drq-2)?

5. Is this a Correction (wrong types) or Enhancement (adding types)?

6. Should this be coordinated with Clinical Reasoning workgroup?

## References

- [FHIR-53984 Jira Issue](https://jira.hl7.org/browse/FHIR-53984)
- [DataRequirement type](https://hl7.org/fhir/6.0.0-ballot4/metadatatypes.html#datarequirement)
- [drq-1 constraint](https://hl7.org/fhir/6.0.0-ballot4/metadatatypes.html#DataRequirement) (codeFilter)
- [drq-2 constraint](https://hl7.org/fhir/6.0.0-ballot4/metadatatypes.html#DataRequirement) (dateFilter)
- Historical: FHIR-32372, FHIR-32373, FHIR-32684 (valueFilter addition)
