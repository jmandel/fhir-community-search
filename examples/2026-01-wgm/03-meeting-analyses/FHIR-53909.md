# FHIR-53909: How do reference search params interact with the alternate-reference extension?

## Issue Overview

This ballot comment asks for clarification on how existing reference search parameters should behave when the alternate-reference extension is used to link to an "Additional Resource" (resources that have been moved out of core).

The alternate-reference extension (https://build.fhir.org/references.html#additional) allows references to Additional Resources when they're not explicitly defined targets for that reference field. However, the spec doesn't explain how search parameters should handle these extended references.

## Current State

The spec at https://build.fhir.org/references.html#additional explains how to use the alternate-reference extension but provides no guidance on search behavior.

Example scenario from the commenter:
- Observation.basedOn normally references ServiceRequest, CarePlan, etc.
- Using alternate-reference extension, you reference a new Additional Resource (ID: 123)
- Question: Does searching `/Observation?based-on=123` find this Observation?

Two possible interpretations:
1. **Intuitive behavior**: Search matches alternate-reference extensions too (user-friendly but not documented)
2. **Strict behavior**: Search only matches explicit reference field values (follows FHIRPath expression literally)

## Stakeholder Perspectives

**James Jahns (Reporter)**: Argues the intuitive behavior is better for usability. Without it, every Additional Resource would need to define custom search parameters for each reference field that might point to it, which "quickly gets messy."

No comments have been added to this issue.

## Related Issues & Discussions

- **FHIR-48422** (Applied): "Basic resource should be implicitly allowed for all Reference and Resource uses" - related to how non-standard resource types are handled in references
- The Additional Resources architecture is new in R6, with several resources being moved out of core
- No Zulip discussions found specifically about alternate-reference search behavior

## Technical Considerations

1. **FHIRPath Expression Problem**: Standard reference search parameters have FHIRPath expressions like `Observation.basedOn` - these won't naturally traverse the alternate-reference extension

2. **Server Implementation Complexity**: 
   - Supporting extension-based search requires servers to understand and index extensions
   - "Pure" FHIRPath-based servers would need special handling

3. **Consistency Across Implementations**: Without guidance, different servers will implement differently, breaking interoperability

4. **Additional Resources Pattern**: As more resources become Additional Resources, this problem will grow

5. **Extension Mechanics**: The alternate-reference extension structure may need to be understood by search implementations

## Potential Courses of Action

### Option A: Mandate Inclusive Search Behavior
- **Description**: Update search documentation to state that reference searches SHOULD also match alternate-reference extensions on the same element
- **Pros**: User-friendly; avoids proliferation of custom search parameters; consistent behavior
- **Cons**: Increases server implementation burden; may not be feasible for all implementations; changes expected behavior
- **Impact**: High - affects all servers and implementations using Additional Resources

### Option B: Require Additional Resources to Define Search Parameters
- **Description**: Document that Additional Resources IGs must define search parameters for any reference fields that might point to them
- **Pros**: Explicit; follows current search parameter model; no server changes needed
- **Cons**: "Messy" as reporter notes; duplicative; easy to miss needed parameters
- **Impact**: Medium - shifts burden to IG authors

### Option C: Make Behavior Implementation-Defined
- **Description**: Document that servers MAY include alternate-reference in search results, but SHOULD document their behavior in CapabilityStatement
- **Pros**: Flexible; acknowledges implementation variation; doesn't mandate difficult changes
- **Cons**: Inconsistent behavior across servers; interoperability concerns
- **Impact**: Low - documentation only

### Option D: Create Standard Search Parameter Extension Pattern
- **Description**: Define a standard way to extend existing search parameters to include alternate-reference, applicable per-IG
- **Pros**: Explicit; opt-in per implementation; doesn't change base behavior
- **Cons**: Complexity; requires IG authors to do extra work; may not be widely implemented
- **Impact**: Medium - new pattern definition

## Questions for the Workgroup

1. What was the intended search behavior when the alternate-reference extension was designed?

2. Is this a gap that was overlooked, or was there a deliberate decision not to address it?

3. Should the burden be on servers (to implement inclusive search) or on Additional Resource IGs (to define search parameters)?

4. How does this interact with CapabilityStatement's declaration of search parameter support?

5. Are there existing implementations using alternate-reference that could inform the decision?

6. Should this be normative guidance or implementation advice?

## References

- Jira Issue: https://jira.hl7.org/browse/FHIR-53909
- Alternate References: https://build.fhir.org/references.html#additional
- Search References: https://build.fhir.org/search.html#reference
- Additional Resources Info: https://chat.fhir.org/#narrow/stream/fhir%2Finfrastructure-wg/topic/Additional%20Resources
