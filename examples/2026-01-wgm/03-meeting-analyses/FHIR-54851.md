# FHIR-54851: Review Search Time Zone Content

## Issue Overview

This issue requests the FHIR-I workgroup to review the current "dragon warning" text on the search page regarding timezone handling. The current warning indicates that managing timezones and offsets in search is "a very difficult area" and that the FHIR implementation community is "still investigating and debating" the best approach.

The warning text suggests that future versions of the specification may impose rules around timezone usage with dates, and invites implementer feedback. The issue asks the committee to review the current rules for date/time search and timezone handling, determine if any changes are necessary, and then revise or remove this cautionary text accordingly.

This is a longstanding discussion area in FHIR. The fundamental tension is between providing precise search semantics (which requires careful timezone handling) and maintaining simplicity for implementers (which suggests minimal timezone requirements).

## Current State

The current FHIR search specification states:
- "Dates do not have time zones, and time zones should not be considered"
- "Where both search parameters and resource element date times do not have time zones, the servers local time zone should be assumed"
- A "dragon warning" exists acknowledging this is an unsolved problem

Servers are expected to publish their default timezone in their capability statement. The specification allows any degree of precision in date searches, but doesn't clearly mandate what precision levels servers must support.

## Stakeholder Perspectives

No comments on this specific ballot issue yet, but historical discussions show:

**Gino Canessa** (Reporter): Raised this as a ballot review item, noting that search specifies that any search without a timezone specified is in the server's time zone, but the normative date search parameter format doesn't allow specifying a timezone with a date.

**Historical Zulip Discussion (2023)**: Multiple implementers debated whether timezones should be allowed on date-only values:
- **Daniel Venton**: Against including timezone with just dates - "I don't think tz with just a ymd value is of any use"
- **Elliot Silver**: For allowing timezones - needed for search certainty when comparing imprecise dates
- **Brian Postlethwaite**: Suggested dropping to lowest precision provided rather than inferring precision

**FHIR-16550 History**: This was marked as a difficult area in 2018-2019, with recognition that timezone correction is complex. The resolution was to add the dragon warning and defer to R5/R6.

## Related Issues & Discussions

- **FHIR-16550** (Published): "Clarify 'date' search parameter" - Added the dragon warning text
- **FHIR-27906** (Published): US Core clarification on search by date precision conformance expectations
- **FHIR-46851**: "_sort for Date is underdefined" - Related date handling issue
- **Zulip: #implementers > Time zone for dates** - 2023 discussion on regex changes for dateTime timezones
- **Zulip: #implementers > Client Timezone** - 2019 discussion on client timezone communication

## Technical Considerations

1. **Timezone vs Offset Confusion**: Timezones (e.g., "America/New_York") are not the same as offsets (e.g., "-05:00"). Offsets are ambiguous and don't account for DST changes.

2. **Client-Server Coordination**: The Date HTTP header has been suggested for conveying client timezone, but this is non-standard and may be auto-set by proxies.

3. **Data Precision Mismatch**: When a date-only value in a resource is compared against a datetime search parameter (or vice versa), the rules for comparison are unclear.

4. **Normative Status**: Parts of search are normative (locked), which limits what changes can be made without deprecation cycles.

5. **Storage Considerations**: Servers may not control how data is stored internally, making UTC-only storage requirements impractical.

## Potential Courses of Action

### Option A: Maintain Status Quo with Updated Warning
- **Description**: Keep current behavior but update the dragon warning text to better describe the current state and known limitations
- **Pros**: No breaking changes; acknowledges reality; allows continued community investigation
- **Cons**: Leaves ambiguity for implementers; doesn't resolve the underlying issue
- **Impact**: Non-substantive documentation change only

### Option B: Require Explicit Timezone/Offset on DateTime Searches
- **Description**: Mandate that all datetime search parameters must include an offset; date-only searches would not have timezone considerations
- **Pros**: Clear, unambiguous semantics; shifts responsibility to client
- **Cons**: Breaking change for existing implementations; more work for clients
- **Impact**: Potentially non-compatible change; would need deprecation period

### Option C: Define Explicit Server Behavior Rules
- **Description**: Define clear rules: (1) date-only searches ignore time entirely, (2) datetime searches require offset, (3) servers must document their behavior in CapabilityStatement
- **Pros**: Clear expectations; backwards compatible if properly specified
- **Cons**: More complex specification text; may still leave edge cases
- **Impact**: Compatible, substantive change

### Option D: Remove the Dragon Warning
- **Description**: Accept that current rules are sufficient and remove the warning, declaring the matter resolved
- **Pros**: Simplifies spec; signals stability to implementers
- **Cons**: May be premature; real issues may still exist in implementations
- **Impact**: Non-substantive documentation change

## Questions for the Workgroup

1. Has sufficient implementer experience accumulated since R4/R5 to resolve this issue, or is more community input still needed?

2. Should the specification require clients to always provide fully-qualified datetime values (with offset) when precision matters?

3. Is it acceptable to define that date-only searches simply ignore time considerations entirely (treating the date as a 24-hour period in an unspecified timezone)?

4. Should the CapabilityStatement be enhanced to allow servers to declare their timezone handling behavior?

5. Are there specific IGs or use cases that have been blocked or complicated by the current ambiguity?

## References

- [FHIR Search Page](https://build.fhir.org/search.html#date)
- [FHIR-54851 Jira Issue](https://jira.hl7.org/browse/FHIR-54851)
- [FHIR-16550 - Original dragon warning issue](https://jira.hl7.org/browse/FHIR-16550)
- [Zulip: Time zone for dates](https://chat.fhir.org/#narrow/stream/implementers/topic/Time%20zone%20for%20dates)
- [Zulip: Client Timezone](https://chat.fhir.org/#narrow/stream/implementers/topic/Client%20Timezone)
