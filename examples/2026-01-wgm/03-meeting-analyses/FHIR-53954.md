# FHIR-53954: %factory and %server are not mature enough to be in a normative standard

## Issue Overview

Brian Postlethwaite argues that the `%factory` and `%server` sections of the FHIRPath specification are not mature enough to be included in normative R6. These features were maturity=0 (Draft) in FHIR R5 and, according to the reporter, have not had sufficient implementation experience to justify promotion to normative status.

The request is to move these sections to an incubator IG (possibly the API incubator for %server, given its API-related nature) where they can mature further with community implementation and feedback before potential future normative inclusion.

This is a significant maturity and process concern - normative status implies long-term stability commitments that may be premature for under-implemented features.

## Current State

In FHIR R5:
- Both `%factory` and `%server` sections were marked as maturity=0 (Draft)
- Limited implementation experience has been reported
- No evidence of significant usage in production systems

In R6 Ballot:
- These sections are proposed for normative status
- This represents a jump from Draft directly to Normative, skipping trial-use phases

The reporter has filed additional detailed issues:
- **FHIR-54074**: Detailed critique of %server functions
- **FHIR-54078**: Detailed critique of %factory functions

## Stakeholder Perspectives

**Reporter (Brian Postlethwaite)**: As a FHIRPath implementer, Brian has direct insight into what has actually been implemented. He notes these features have not been significantly implemented or used, making normative status inappropriate.

From FHIR-54074 (%server critique):
- Questions whether ANY engines implement %server
- Raises security concerns about data manipulation functions
- Notes missing error handling, authorization coverage
- Suggests only `read`, `search`, `capabilities`, and `everything` might be reasonable
- Calls out manipulation functions (create, update, delete, patch) as potential attack vectors

From FHIR-54078 (%factory critique):
- Notes duplication with new FHIRPath instance selector syntax (FHIR-33044)
- Points out inconsistent examples and documentation
- Suggests simplifying to fewer, well-defined factory functions
- Proposes fluent-style alternatives

No other stakeholders have commented yet.

## Related Issues & Discussions

- **FHIR-54074**: %server detailed critique - extensive list of problems
- **FHIR-54078**: Type Factory detailed critique - duplication with CQL syntax
- **FHIR-53951**: Documentation gaps across FHIRPath functions
- **FHIR-53953**: Remote interaction documentation needs
- **FHIR-53960**: Inconsistent error handling patterns
- **FHIR-33044**: Base FHIRPath instance selector syntax (now normative in CQL)

**Zulip**: No direct discussion found on %factory/%server maturity, though the broader FHIRPath community discussions suggest limited adoption of these advanced features.

## Technical Considerations

1. **Normative commitment**: Once normative, changes require backward compatibility. Premature normative status locks in potentially problematic designs.

2. **Security risks**: %server manipulation functions (create, update, delete, patch) in FHIRPath expressions could enable:
   - Data exfiltration via trace expressions
   - Injection attacks through search parameters or invariants
   - Unintended side effects in questionnaires

3. **Implementation burden**: Implementing %server fully requires essentially embedding a FHIR client within the FHIRPath engine - significant complexity for uncertain benefit.

4. **CQL overlap**: %factory duplicates functionality now standardized in CQL's instance selector syntax, creating specification fragmentation.

5. **Use case clarity**: The spec doesn't clearly articulate what problems %factory and %server solve that couldn't be addressed otherwise.

6. **FML relationship**: FHIR Mapping Language has similar capabilities - potential for consolidation.

## Potential Courses of Action

### Option A: Move Both to Incubator IG
- **Description**: Remove %factory and %server from normative FHIRPath, create/use incubator IG
- **Pros**: 
  - Follows proper maturity progression
  - Allows refinement without normative constraints
  - Reduces security surface of normative spec
  - Enables experimentation and community feedback
- **Cons**: 
  - Work already done may need rework
  - Delays availability in normative form
  - May fragment implementations
- **Impact**: Non-compatible (removes content from normative)

### Option B: Keep as STU Within Normative Page
- **Description**: Mark %factory and %server sections as STU/Trial-Use within the otherwise normative page
- **Pros**: 
  - Keeps content visible and discoverable
  - Allows changes in future versions
  - Acknowledges maturity concerns
- **Cons**: 
  - Mixed maturity on single page is confusing
  - May not satisfy implementer concerns
  - Still implies more stability than warranted
- **Impact**: Compatible (status change only)

### Option C: Selective Inclusion
- **Description**: Move %server to incubator, keep simplified %factory for basic type construction
- **Pros**: 
  - Addresses highest-risk content (%server)
  - Maintains useful basic functionality
  - Aligns %factory with CQL patterns
- **Cons**: 
  - Partial solution
  - Still needs %factory refinement work
- **Impact**: Non-compatible for %server, revision for %factory

### Option D: Normative with Security Constraints
- **Description**: Keep both normative but add strong security guidance and context restrictions
- **Pros**: 
  - Moves forward with content
  - Addresses security concerns explicitly
- **Cons**: 
  - Doesn't address implementation maturity
  - Security guidance doesn't fix design issues
  - Locks in current design
- **Impact**: Compatible, substantive

## Questions for the Workgroup

1. What implementation experience exists for %factory and %server? Are there production implementations?

2. Is the jump from maturity=0 to normative appropriate for any feature?

3. Should manipulation functions (create, update, delete, patch) ever be available in FHIRPath, given security implications?

4. How should %factory relate to CQL's instance selector syntax going forward?

5. What is the appropriate incubator location - FHIRPath IG, API incubator, or new IG?

6. Should this decision be coordinated with the CQL/Clinical Reasoning workgroup?

## References

- [FHIR-53954 Jira Issue](https://jira.hl7.org/browse/FHIR-53954)
- [FHIR-54074: %server critique](https://jira.hl7.org/browse/FHIR-54074)
- [FHIR-54078: %factory critique](https://jira.hl7.org/browse/FHIR-54078)
- [FHIRPath Specification Page](https://hl7.org/fhir/6.0.0-ballot4/fhirpath.html)
- [FHIR-33044: FHIRPath instance selector](https://build.fhir.org/ig/HL7/FHIRPath/branches/BP-FHIR-44774/index.html#instance-selector)
