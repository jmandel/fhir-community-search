# FHIR-55368: Align DiagnosticReport and Composition and Allow DiagnosticReport to Serve as the Base for a FHIR Document Bundle

## Issue Overview

This issue proposes a significant architectural change: allowing DiagnosticReport to serve as the base (first entry) of a FHIR Document bundle, alongside or instead of Composition. Currently, only Composition can serve this role.

The motivation comes from European and international laboratory report implementations, where there is a need for laboratory reports to be treated as full-fledged "documents" (signed, validated, legally binding). The current requirement to use Composition creates an awkward design where both Composition and DiagnosticReport exist at the "top level" of the report.

The proposal suggests aligning DiagnosticReport and Composition, possibly through a common interface pattern, so both can serve as document bases.

## Current State

**Current FHIR Document Structure:**
- A FHIR Document is a Bundle with type "document"
- The first entry MUST be a Composition resource
- Composition provides document structure (sections, authors, attesters, etc.)
- DiagnosticReport.composition can reference a Composition for report structuring

**EU Laboratory Report IG Approach:**
- Uses both Composition (for document compliance) and DiagnosticReport (for clinical content)
- Creates a compromise structure where both are at the "top level"
- Attempts to balance FHIR document requirements with DiagnosticReport-based searching

## Stakeholder Perspectives

**Robert Hausam** (Reporter):
- This would "considerably simplify" the EU and UV laboratory report IG designs
- Current design is "somewhat awkward" with both Composition and DiagnosticReport at top level
- Suggests a common interface pattern that both resources could implement

**From Zulip Discussion (europe > Laboratory Report):**

**Kevin Mayfield**: 
- Working on UK genomics implementations compatible with EU Lab Report
- Questions whether DiagnosticReport SHALL always reference Composition
- Notes different workflows: FHIR RESTful vs FHIR Document approaches

**Jose Costa-Teixeira**: 
- Differentiates "lab report" (document) from "lab results" (workflow)
- Suggests lab workflow should be separate from final document packaging

**Rob Hausam**: 
- The EU approach is a "compromise approach" that "to some extent likely satisfies both everyone - and no one"
- Describes the rationale in EU Lab Report IG section 5.1

**From Genomics WGM Discussion (Zulip genomics):**

**Bob Dolin**: Proposed adding a document bundle profile to the genomics IG for structured reports.

## Related Issues & Discussions

- [EU Laboratory Report IG](https://build.fhir.org/ig/hl7-eu/laboratory/)
- [UV Laboratory Report IG](https://build.fhir.org/ig/HL7/uv-lab-rep-ig/)
- [EU Laboratory Report Design Choice](https://build.fhir.org/ig/hl7-eu/laboratory/design-choice.html)
- [Zulip: europe > Laboratory Report - FHIR/v2 Workflow verse FHIR Document](https://chat.fhir.org/#narrow/stream/europe/topic/Laboratory%20Report%20-%20FHIR%2Fv2%20Workflow%20verse%20FHIR%20Document)
- [Zulip: europe > EU Laboratory - DiagnosticReport and DocumentReference](https://chat.fhir.org/#narrow/stream/europe/topic/EU%20Laboratory%20-%20DiagnosticReport%20and%20DocumentReference)

## Technical Considerations

1. **Document Definition**: FHIR Documents are defined as having specific characteristics (immutability, signature capability, narrative requirements). Would DiagnosticReport meet these?

2. **Composition Features**: Composition has sections, attesters, events, and other document-specific elements. DiagnosticReport would need similar capabilities.

3. **Search Implications**: One motivation is to allow searching via DiagnosticReport endpoint while still treating results as documents. This dual-mode behavior has implications.

4. **Interface Pattern**: Creating a common "Document" interface that both implement could work, but interfaces have limited adoption in FHIR.

5. **Backward Compatibility**: Existing document-processing systems expect Composition. Adding DiagnosticReport would require updates.

6. **Validation**: Document bundles have specific validation rules tied to Composition. These would need to be extended or generalized.

7. **Jurisdictional Requirements**: European requirements for legally signed documents may differ from other jurisdictions.

## Potential Courses of Action

### Option A: Allow DiagnosticReport as Document Base
- **Description**: Modify FHIR document definition to allow either Composition or DiagnosticReport as the first entry
- **Pros**: Directly addresses the EU use case; simplifies laboratory report IGs
- **Cons**: Significant change to document processing; compatibility concerns; requires DiagnosticReport enhancements
- **Impact**: Non-compatible, substantive change to document model

### Option B: Create Common DocumentBase Interface
- **Description**: Define an interface that both Composition and DiagnosticReport (and potentially others) implement, and define documents in terms of that interface
- **Pros**: Extensible pattern; clean architecture
- **Cons**: Interfaces have limited tooling support; significant work; may be over-engineered
- **Impact**: Compatible, substantive change; new interface definition

### Option C: Enhance DiagnosticReport.composition Integration
- **Description**: Improve how DiagnosticReport references Composition so the combined structure is less awkward
- **Pros**: Works within existing model; no document definition changes
- **Cons**: Doesn't fundamentally address the dual-resource issue; remains complex
- **Impact**: Compatible, possibly non-substantive

### Option D: Create LaboratoryDocument Resource
- **Description**: Create a new resource specifically for laboratory documents that combines Composition and DiagnosticReport characteristics
- **Pros**: Purpose-built for the use case
- **Cons**: Resource proliferation; domain-specific solution to general problem
- **Impact**: Major change; new resource

### Option E: Document via Profile/Extension
- **Description**: Define a profile on Composition specifically for diagnostic reports that tightly integrates with DiagnosticReport
- **Pros**: Works within existing framework; can be developed in IGs first
- **Cons**: Doesn't address the fundamental architectural tension
- **Impact**: Non-substantive to core; creates profile

## Questions for the Workgroup

1. Is the EU laboratory report use case sufficiently common/important to justify changing the FHIR document model?

2. What specific features would DiagnosticReport need to serve as a document base? Is that scope creep?

3. Should this be solved at the core spec level, or should IGs continue to work around the current limitations?

4. How would existing document-processing systems be affected?

5. Is there precedent for other resources serving as document bases (e.g., could imaging reports, pathology reports face similar issues)?

6. Should this coordinate with the Structured Documents workgroup?

## References

- [FHIR-55368 Jira Issue](https://jira.hl7.org/browse/FHIR-55368)
- [FHIR Documents](https://build.fhir.org/documents.html)
- [Composition Resource](https://build.fhir.org/composition.html)
- [DiagnosticReport Resource](https://build.fhir.org/diagnosticreport.html)
- [EU Laboratory Report IG](https://build.fhir.org/ig/hl7-eu/laboratory/)
- [UV Laboratory Report IG](https://build.fhir.org/ig/HL7/uv-lab-rep-ig/)
- [Zulip: Laboratory Report discussions](https://chat.fhir.org/#narrow/stream/europe/topic/Laboratory%20Report%20-%20FHIR%2Fv2%20Workflow%20verse%20FHIR%20Document)
