# FHIR-53850: Not all CanonicalResource search parameters are defined in all implementations

## Issue Overview

James Jahns identifies an inconsistency in how search parameters defined on the CanonicalResource interface are implemented across the resources that claim to implement that interface.

The CanonicalResource interface (http://build.fhir.org/canonicalresource.html) defines "search parameters defined by this interface for all implementations." However, when examining the Search Parameter Registry, these parameters are not consistently defined for all canonical resources.

This creates a situation where the interface contract (all CanonicalResources support these search parameters) doesn't match the actual resource definitions.

## Current State

The reporter provides a detailed analysis showing gaps:

### Resources Missing ALL Context/Description/Jurisdiction Parameters:
- SubscriptionTopic
- DeviceDefinition
- ObservationDefinition
- SpecimenDefinition

### Other Notable Gaps:

| Parameter | Missing From |
|-----------|-------------|
| context (all variants) | DeviceDefinition, ObservationDefinition, SpecimenDefinition, SubscriptionTopic |
| date | DeviceDefinition, ObservationDefinition, SpecimenDefinition |
| description | DeviceDefinition, ObservationDefinition, SpecimenDefinition, SubscriptionTopic, ExampleScenario |
| identifier | CompartmentDefinition |
| jurisdiction | DeviceDefinition, ObservationDefinition, SpecimenDefinition, SubscriptionTopic, CompartmentDefinition, Evidence, EvidenceVariable |
| name | ExampleScenario |
| publisher | ObservationDefinition, SpecimenDefinition, SubscriptionTopic |
| status | DeviceDefinition |
| title | DeviceDefinition, ExampleScenario, CompartmentDefinition, NamingSystem, SearchParameter |
| url | (none - only param present everywhere) |
| version | ObservationDefinition, SpecimenDefinition |

## Stakeholder Perspectives

**Reporter (James Jahns):** Seeking consistency between the CanonicalResource interface specification and actual resource search parameter definitions. This affects implementers who expect uniform search behavior across canonical resources.

No other comments have been posted yet.

### Zulip Discussions
- Gino Canessa (2025-08) discussed how canonical resources use both uri and Reference search types
- Discussion about `url` search parameter behavior across canonical resources
- Questions about when to use uri vs Reference for canonical searches
- Historical discussions about adding url element to Group when it became canonical

## Related Issues & Discussions

### Related Concepts
- CanonicalResource interface: Defines common elements and search parameters
- MetadataResource: Related interface for resources with publishing metadata
- Search Parameter Registry: Lists all search parameters per resource

### Zulip Context
- **"Search parameters for canonical resources"**: Discussion about how canonical search should work
- Discussion indicates some flexibility/vestiges from earlier FHIR versions

## Technical Considerations

1. **Interface Contract**: If CanonicalResource says these search parameters are "for all implementations," resources should have them

2. **Element Presence**: Some resources may lack the underlying elements (e.g., if a resource doesn't have `context`, it can't have a `context` search parameter)

3. **Work Group Ownership**: Different resources are owned by different work groups, leading to inconsistent application

4. **Historical Evolution**: As CanonicalResource interface evolved, not all resources were updated

5. **Search Parameter XML Files**: Each resource has a separate search parameter bundle XML that needs to be maintained

6. **Validation Impact**: Validators might assume interface-defined parameters exist on all implementing resources

## Potential Courses of Action

### Option A: Add All Missing Search Parameters
- **Description**: Update each resource's search parameter definitions to include all CanonicalResource interface parameters
- **Pros**: 
  - Full consistency with interface spec
  - Predictable search behavior
  - Clear contract fulfillment
- **Cons**: 
  - Some resources may not have the underlying elements
  - Work across multiple work groups
  - May result in parameters that don't work (no element to search on)
- **Impact**: High effort, full consistency

### Option B: Add Parameters Only Where Elements Exist
- **Description**: Add missing search parameters only where the corresponding element exists on the resource
- **Pros**: 
  - Practical approach
  - All added parameters are functional
  - Less work than full coverage
- **Cons**: 
  - Still inconsistent across resources
  - Interface claim still doesn't match reality
- **Impact**: Medium effort, partial consistency

### Option C: Weaken Interface Language
- **Description**: Change CanonicalResource to say these are "typical" or "recommended" search parameters rather than required for all
- **Pros**: 
  - Aligns spec with reality
  - No resource changes needed
  - Honest about current state
- **Cons**: 
  - Reduces interface value
  - Doesn't improve search consistency
  - May disappoint implementers
- **Impact**: Low effort, reduces expectations

### Option D: Require Elements on All CanonicalResources
- **Description**: If the interface requires these search parameters, ensure all implementing resources have the underlying elements
- **Pros**: 
  - True interface consistency
  - Comprehensive solution
  - Improves resource uniformity
- **Cons**: 
  - Major change to many resources
  - Some elements may not make sense for all resources
  - Cross-work-group coordination
- **Impact**: Very high effort, most complete

### Option E: Document Known Gaps
- **Description**: Add a note to CanonicalResource acknowledging that not all resources support all parameters, with a table of actual coverage
- **Pros**: 
  - Transparent
  - No structural changes
  - Implementers know what to expect
- **Cons**: 
  - Doesn't fix the inconsistency
  - Documentation overhead
- **Impact**: Low effort, informational

## Questions for the Workgroup

1. Was the intent that ALL CanonicalResources support ALL interface-defined search parameters?

2. For resources missing underlying elements (like `context`), should those elements be added to enable the search parameters?

3. Which work group owns the decision to add elements/parameters to specific resources?

4. Should there be a conformance test that validates interface search parameter coverage?

5. Are there resources that intentionally don't support certain interface parameters?

6. How should the Search Parameter Registry be kept in sync with interface requirements?

## References

- Jira: https://jira.hl7.org/browse/FHIR-53850
- CanonicalResource interface: https://build.fhir.org/canonicalresource.html
- Search Parameter Registry: https://build.fhir.org/searchparameter-registry.html#canonicalresource
- Zulip "Search parameters for canonical resources": https://chat.fhir.org/#narrow/stream/179166-implementers/topic/Search.20parameters.20for.20canonical.20resources
