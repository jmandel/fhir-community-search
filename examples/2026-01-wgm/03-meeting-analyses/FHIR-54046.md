# FHIR-54046: SubscriptionTopic.trigger.event should be 0..*

## Issue Overview

James Jahns proposes changing `SubscriptionTopic.trigger.event` from 0..1 to 0..* cardinality. The current structure requires repeating the entire `trigger` element (including `canFilterBy`, `notificationShape`, etc.) when multiple events share the same trigger configuration.

The specific use case mentioned is a SubscriptionTopic for ADT (Admission, Discharge, Transfer) events where many distinct events (but not all) should trigger notifications with identical filter and shape configurations. With 0..1 cardinality, this requires duplicating the entire trigger definition for each event, leading to verbose and redundant SubscriptionTopic definitions.

## Current State

**Current structure:**
```
SubscriptionTopic
  └── trigger (0..*)
        ├── description
        ├── resource (required)
        ├── supportedInteraction
        ├── queryCriteria
        ├── fhirPathCriteria
        ├── event (0..1)          <-- Currently single
        ├── canFilterBy (0..*)
        └── notificationShape (0..*)
```

**Problem scenario:**
For ADT notifications covering events A01, A02, A03, A04, A05, A06 (but not A07, A08), current structure requires:
- 6 separate `trigger` elements
- Each with identical `canFilterBy` and `notificationShape` definitions
- Significant duplication

**Proposed change:**
Change `event` to 0..* so a single trigger can list multiple events:
```
trigger
  ├── event: [A01, A02, A03, A04, A05, A06]
  ├── canFilterBy: [...]
  └── notificationShape: [...]
```

## Stakeholder Perspectives

**Reporter (James Jahns)**: Has practical experience with SubscriptionTopic definitions for ADT-like scenarios where multiple events share identical trigger configurations.

No other comments yet.

## Related Issues & Discussions

**Zulip** - #subscriptions:
- Discussion about event definitions and topics: "SubscriptionTopic includes derivedFromUri and derivedFromCanonical fields to ensure that clients can find what they are looking for"
- Gino Canessa noted: "there could be 'standard' topics published by an IG, and they can have specialized logic that identifies an event like an ADT"
- Discussion about using event codes vs FHIRPath criteria for trigger definition

**Zulip** - #implementers > ADT:
- Cooper Thompson: "Since ADT is inherently about events, an important consideration in doing ADT in FHIR is the event definition. In FHIR, there are maybe three different ways to do that: SubscriptionTopic, EventDefinition..."

## Technical Considerations

1. **Semantic clarity**: Multiple events in one trigger means "any of these events" - is that always the intended semantics?

2. **Filter applicability**: Do `canFilterBy` filters apply identically to all events? Some events might have different applicable filters.

3. **Shape consistency**: Is the same `notificationShape` appropriate for all events in a group?

4. **Query optimization**: Servers need to efficiently match incoming events against topics. Multiple events per trigger could affect indexing strategies.

5. **Derivation impact**: When deriving from a topic, how does multiple-event handling work?

6. **Backward compatibility**: Changing from 0..1 to 0..* is backward compatible - existing topics remain valid.

7. **Alternative solutions**: 
   - Event hierarchies (parent events)
   - Event grouping code systems
   - FHIRPath criteria to match multiple events

## Potential Courses of Action

### Option A: Change event to 0..*
- **Description**: Change cardinality from 0..1 to 0..* as proposed
- **Pros**: 
  - Reduces redundancy in topic definitions
  - Simpler topic authoring for multi-event scenarios
  - Backward compatible
  - Straightforward change
- **Cons**: 
  - May mask cases where events need different configurations
  - Servers need to handle multiple-event matching
  - Semantic of "any of these" needs documentation
- **Impact**: Compatible, substantive (cardinality change)

### Option B: Keep 0..1, Recommend Event Hierarchies
- **Description**: Document that event code systems should define parent codes for event groups
- **Pros**: 
  - Cleaner semantic model
  - Leverages terminology capabilities
  - No structural change
- **Cons**: 
  - Requires event code system design work
  - Not all event sets have natural hierarchies
  - Doesn't address arbitrary event groupings
- **Impact**: Non-substantive (guidance)

### Option C: Add eventSet Element
- **Description**: Add separate `eventSet` element (0..1, referencing a ValueSet of events) alongside single `event`
- **Pros**: 
  - Explicit grouping mechanism
  - Leverages ValueSet infrastructure
  - Maintains single-event simplicity
- **Cons**: 
  - More complex structure
  - Requires ValueSet management
  - May be overkill
- **Impact**: Compatible, substantive

### Option D: Keep 0..1, Accept Duplication
- **Description**: Document that duplication is expected for multi-event scenarios
- **Pros**: 
  - No change risk
  - Forces explicit consideration of each event
- **Cons**: 
  - Verbose topic definitions
  - Maintenance burden
  - Doesn't address reporter's concern
- **Impact**: Non-substantive

## Questions for the Workgroup

1. Is the semantic of "multiple events with same filters/shape" common enough to warrant the change?

2. Are there cases where different events legitimately need different canFilterBy or notificationShape configurations?

3. Should the change include guidance on when to use multiple events vs separate triggers?

4. How does this interact with derivedFrom patterns for extending topics?

5. Are there server implementation concerns with matching multiple events?

6. Should this coordinate with Da Vinci or other IGs using SubscriptionTopic extensively?

## References

- [FHIR-54046 Jira Issue](https://jira.hl7.org/browse/FHIR-54046)
- [SubscriptionTopic resource](https://build.fhir.org/subscriptiontopic.html)
- [SubscriptionTopic.trigger structure](https://build.fhir.org/subscriptiontopic-definitions.html#SubscriptionTopic.trigger)
- [Zulip: Subscriptions - State Changes Blog](https://chat.fhir.org/#narrow/stream/subscriptions/topic/State%20Changes%20Blog)
- [Zulip: implementers - ADT](https://chat.fhir.org/#narrow/stream/implementers/topic/ADT)
