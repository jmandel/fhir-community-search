# FHIR-53810: FHIR R6 should address the referred signature comments

## Issue Overview

Bas van den Heuvel raises a meta-issue: a set of 11 signature-related Jira tickets were submitted based on security expert review of the revised FHIR signatures page, but these issues have not been addressed in R6 ballot 4. This ticket tracks the status of all those signature-related issues.

The signatures page was substantially rewritten for R6, and these comments represent expert feedback on that rewrite. The reporter has reviewed the ballot and found that while some tickets were marked as resolved, the actual changes haven't appeared in the ballot.

This is particularly concerning as digital signatures are a security-critical area where precise specification is essential.

## Current State

The following tickets were filed and their status according to the reporter:

| Ticket | Title | Jira Resolution | In Ballot? | Notes |
|--------|-------|-----------------|------------|-------|
| FHIR-52810 | Signature on Bundle should not use id | Resolved - change to use '#/' pointer | No | Still uses id in ballot |
| FHIR-52811 | Use of # in Provenance is unclear | Unresolved | No | 6.1.2.2.9 wording confusing |
| FHIR-52812 | Additional canonical rules for signing whole bundle | Unresolved | No | Related to FHIR-52811 |
| FHIR-52813 | Countersigning not completely clear | Resolved - use '#/' syntax | No | No '#/' seen in ballot |
| FHIR-52814 | Update canonical rules for documents | Unresolved | No | No changes |
| FHIR-52815 | Change meta behavior for Signatures | Unresolved | No | Still removes whole meta for #static |
| FHIR-52816 | Term "Electronic Signature" is confusing | Unresolved | No | No term changes |
| FHIR-52817 | Base64 serialization is imprecise | Unresolved | No | Needs more explanation |
| FHIR-52818 | Recommend JAdES-B-T for non-repudiation | Resolved | No | No updates seen |
| FHIR-52819 | Recommend XAdES-T for non-repudiation | Resolved | No | No updates seen |
| FHIR-52820 | Add JAdES-B-T example | Unresolved | No | No example added |

## Stakeholder Perspectives

**Reporter (Bas van den Heuvel, Philips):** Working with security experts who reviewed the signatures page. Concerned that resolved tickets haven't been implemented.

**Essien Ge (Security expert, Zulip):** Provided extensive rationale for signature recommendations, distinguishing between:
- **Integrity signatures**: For data integrity protection at rest/transit
- **Non-repudiation signatures**: For legal/regulatory purposes (like physician signatures)
- Recommends JAdES-B-T or XAdES-B-T levels for non-repudiation

**Grahame Grieve (Zulip):** Key contributor to signature page rewrite, engaged in discussions about fragment identifiers and pointer-based signatures.

**John Moehrke (Zulip):** Security WG participant, discussed Provenance.target vs signature coverage and historical thinking.

**Eric Haas (Zulip):** Active in signature discussions, provided editorial feedback and examples.

## Related Issues & Discussions

### Primary Related Issues (11 signature tickets)
- FHIR-52810 through FHIR-52820 (detailed above)

### Zulip Discussions
- **"Signature comments"** (#fhir/infrastructure-wg): Initial filing of tickets and rationale
- **"Provenance Signature"** (#Security and Privacy): Extensive discussion about Provenance-based signatures vs Bundle.signature, with 120+ messages covering:
  - XML vs JSON signature formats
  - Multiple target signing
  - Co-signing and counter-signing patterns
  - JAdES/XAdES profile recommendations
  - Worked examples

### Related Work
- Substantial rewrite of signatures page in R6
- Discussion of deprecating Bundle.signature in favor of Provenance-based signatures

## Technical Considerations

1. **Pointer vs ID References**: FHIR-52810 proposed using `#/` pointer-based fragment identifiers instead of Bundle.id to avoid signature breakage when documents move between servers

2. **Non-Repudiation Requirements**: For legal/regulatory compliance (e.g., EU 910/2014), JAdES/XAdES profiles provide necessary guarantees

3. **Integrity vs Non-Repudiation**: Different signing purposes require different approaches - integrity can use simpler JWS/XMLDSIG, non-repudiation needs AdES profiles

4. **Canonicalization Rules**: The `#static` canonicalization's handling of meta is questioned - should only remove volatile parts (versionId, lastUpdated) not entire meta

5. **Provenance vs Bundle.signature**: Major architectural question about where signatures belong

6. **Long-term Signatures**: JAdES-B-LT and XAdES-B-LTA provide long-term validation capability

7. **Double Base64**: JWT signatures already Base64 encode; storing in FHIR requires another Base64 encoding - this needs documentation

## Potential Courses of Action

### Option A: Implement All Resolved Tickets
- **Description**: Ensure all tickets marked "Resolved" actually have their changes in the spec before R6 publication
- **Pros**: 
  - Maintains integrity of Jira process
  - Addresses reviewed security feedback
  - Minimal new decisions needed
- **Cons**: 
  - May delay R6 timeline
  - Some implementations may already have coded to ballot
- **Impact**: Work to implement already-decided changes

### Option B: Comprehensive Signature Review
- **Description**: Given the number of outstanding issues, conduct a focused review of the entire signatures page with security experts before R6
- **Pros**: 
  - Holistic approach
  - Catches interrelated issues
  - Security-critical area deserves attention
- **Cons**: 
  - Time-intensive
  - May identify more issues
  - Could delay R6
- **Impact**: Higher effort, more complete result

### Option C: Defer to R6.1 or R7
- **Description**: Publish R6 with current signature content, address all issues in a subsequent release
- **Pros**: 
  - Doesn't delay R6
  - Time to do comprehensive work
- **Cons**: 
  - Security content remains incomplete
  - Implementations built on R6 may need rework
  - Could cause interoperability problems
- **Impact**: Defers problem, risks implementations

### Option D: Partial Implementation + STU Content
- **Description**: Implement critical fixes, mark remaining signature content as STU (not normative)
- **Pros**: 
  - Allows iteration
  - Critical fixes can proceed
  - Acknowledges content immaturity
- **Cons**: 
  - Signals signatures aren't ready
  - Complex normative landscape
- **Impact**: Pragmatic compromise

## Questions for the Workgroup

1. Why haven't resolved tickets been implemented in the ballot? Is this a process failure or intentional deferral?

2. Should the signatures page be normative in R6 given the number of outstanding issues?

3. Who is responsible for implementing signature ticket resolutions - FHIR-I, Security, or joint?

4. Is there consensus on the architectural direction (Provenance-based vs Bundle.signature)?

5. Should we require security expert sign-off before making signatures normative?

6. What's the timeline feasibility for addressing these before R6 publication?

## References

- Jira: https://jira.hl7.org/browse/FHIR-53810
- Signatures page (R6 ballot): https://hl7.org/fhir/6.0.0-ballot4/signatures.html
- FHIR-52810: https://jira.hl7.org/browse/FHIR-52810
- Zulip #Security and Privacy "Provenance Signature": Extensive discussion thread
- JAdES specification: https://www.etsi.org/deliver/etsi_ts/119100_119199/11918201/
- XAdES specification: https://www.etsi.org/deliver/etsi_ts/101900_101999/101903/
