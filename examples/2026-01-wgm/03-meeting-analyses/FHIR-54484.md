# FHIR-54484: Transform Functions issues (collection of them)

## Issue Overview

Brian Postlethwaite has submitted a comprehensive list of documentation issues with the FHIR Mapping Language (FML) transform functions section. This is an omnibus ticket covering multiple deficiencies in how transform functions are documented in the R6 ballot specification.

The issues range from basic formatting problems (table vs. headings) to substantive technical gaps (missing parameter types, missing examples, duplicate entries) to conceptual questions about the design of the transform function set (why have transforms that duplicate FHIRPath functions?).

Addressing these issues would significantly improve the usability and implementability of the FML specification.

## Current State

The transform functions table at https://hl7.org/fhir/6.0.0-ballot4/mapping-language.html has the following problems identified:

### Documentation Format Issues:
- Transform functions documented in a table format rather than headings, making it harder to link to specific functions and provide detailed documentation
- No examples provided for transform functions
- Parameter types not documented for all transforms

### Specific Transform Issues:

1. **escape transform**: Parameter definitions missing; relationship to FHIRPath encode/decode functions not explained

2. **create transform**: 
   - FHIRPath equivalent (`%factory` or new CQL-style create) not documented
   - When multiple FHIR versions are in play, unclear if this uses source or target type provider (suspected target)

3. **cast transform**:
   - Has equivalent FHIRPath expression (`ofType(X)` or `as`)
   - How is this different from source type casting?
   - Is it even needed when group type rules exist?
   - Type provider question (source vs target)

4. **reference transform**: Documentation doesn't describe what it does or provide examples; unclear how it compares to `pointer` transform

5. **translate transform**: Appears multiple times in the table (duplicate entries)

### Design Questions:
- Why have transform functions that exactly replicate FHIRPath functions (`truncate`, `translate`, `cast`)?
- Should examples show FHIRPath alternatives where they exist?

## Stakeholder Perspectives

**Reporter (Brian Postlethwaite):** As an implementer of FML tooling, Brian needs clear, unambiguous documentation of each transform function to implement them correctly.

**Related Issue (FHIR-54485)**: Also filed by Brian, asking for FML date format codes to be added to FHIRPath's toDate/toDateTime functions - showing the relationship between FML and FHIRPath.

No other comments have been posted yet.

## Related Issues & Discussions

- **FHIR-54485**: toDate/toDateTime format codes (related to transform function documentation)
- **FHIR-54481**: No official FML to StructureMap mapping (transform functions are part of this gap)

### Zulip Discussions
- #FHIR Mapping Language discussions show users struggling with transform function documentation
- Multiple questions about when to use transforms vs FHIRPath expressions
- Discussion about `translate` function usage

## Technical Considerations

1. **FHIRPath Overlap**: Several transforms duplicate FHIRPath functionality:
   - `truncate` → `substring()`
   - `translate` → FHIRPath's `%terminologies.translate()`
   - `cast` → `ofType()` or `as()`
   
2. **Type Provider Context**: In cross-version mapping scenarios, transforms need clarity on whether they resolve types from source or target context

3. **Pointer vs Reference**: The distinction between `pointer` and `reference` transforms is unclear - both seem to deal with references

4. **Backward Compatibility**: Changing or removing duplicate transforms could break existing FML files

5. **Normative Implications**: Transform functions are core to FML - documentation gaps create interoperability risk for R6 normativity

## Potential Courses of Action

### Option A: Comprehensive Documentation Overhaul
- **Description**: Reformat transform functions as individual sections with:
  - Formal parameter definitions with types
  - At least one example per transform
  - FHIRPath equivalents where applicable
  - Clear description of behavior
  - Links to related concepts
- **Pros**: 
  - Addresses all documentation gaps
  - Improves developer experience significantly
  - Enables proper testing/conformance
- **Cons**: 
  - Significant documentation effort
  - May delay ballot timeline
- **Impact**: High effort, high value

### Option B: Incremental Fixes
- **Description**: Fix the most critical issues (missing parameter types, duplicate entries, confusing descriptions) while deferring comprehensive examples to a later release
- **Pros**: 
  - Lower effort
  - Addresses blocking issues
  - Compatible with ballot timeline
- **Cons**: 
  - Documentation remains incomplete
  - Some confusion persists
- **Impact**: Medium effort, addresses urgent issues

### Option C: Deprecate Redundant Transforms
- **Description**: Deprecate transforms that duplicate FHIRPath functions and document FHIRPath as the preferred approach
- **Pros**: 
  - Simplifies the transform function set
  - Reduces confusion about when to use which
  - Leverages existing FHIRPath documentation
- **Cons**: 
  - Breaking change for existing FML content
  - May not be appropriate for R6 normative release
- **Impact**: Medium effort, potentially controversial

### Option D: Move to Separate FML IG
- **Description**: As suggested in FHIR-54486, move FML documentation (including transform functions) to a dedicated Implementation Guide with its own maturity track
- **Pros**: 
  - Allows focused attention on FML documentation
  - Can evolve independently
  - Doesn't delay core spec
- **Cons**: 
  - Significant structural change
  - May reduce visibility of FML
- **Impact**: High effort, strategic decision

## Questions for the Workgroup

1. What is the minimum documentation standard for transform functions to be considered "normatively specified"?

2. Should redundant transforms (those that duplicate FHIRPath) be deprecated or retained for convenience?

3. Who should be responsible for creating examples - the WG or community contributions?

4. Can the duplicate `translate` entries be fixed immediately as an editorial correction?

5. Is there bandwidth to address all these issues before R6 ballot closes, or should some be deferred?

## References

- Jira: https://jira.hl7.org/browse/FHIR-54484
- Transform functions table: https://hl7.org/fhir/6.0.0-ballot4/mapping-language.html
- Related FHIR-54485: https://jira.hl7.org/browse/FHIR-54485
- FHIRPath specification: https://hl7.org/fhirpath/
